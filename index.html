<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspens√µes de Expedientes 2025</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/bcjzam8.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://i.imgur.com/bcjzam8.png" sizes="64x64">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <style>
        /* Mant√©m todo o seu CSS atual */
        /* ... (todo o CSS existente no seu c√≥digo, voc√™ mant√©m) ... */

        /* Apenas para dar uma melhorada na lista de suspens√µes */
        .suspension-item {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            line-height: 1.5;
        }
        .suspension-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://i.imgur.com/bcjzam8.png" alt="Logo TJPA" class="header-image">
        Calend√°rio de Suspens√µes 2025
        <button class="contrast-button" onclick="toggleContrast()">
            <svg class="contrast-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22V2Z" fill="white"/>
            </svg>
            Alto Contraste
        </button>
    </div>

    <div class="calendar-container" id="calendarContainer"></div>

    <div class="legend-container">
        <div class="legend-item">
            <span class="legend-square-judiciario"></span> Poder Judici√°rio do Estado do Par√°
        </div>
        <div class="legend-item">
            üî¥ Situa√ß√£o: Suspens√£o de Prazos
        </div>
        <div class="legend-item">
            üîµ Situa√ß√£o: Atendimento Remoto (Sem Suspens√£o de Prazo)
        </div>
    </div>

    <div class="info-container" id="infoContainer">
        <h2>Informa√ß√µes da Suspens√£o de Expediente</h2>
        <div class="month-header" id="selectedMonth"></div>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Pesquisar por unidade ou motivo..." onkeyup="searchSuspensions()">
        </div>
        <div class="info-details">
            <ul id="suspensionsList"></ul>
        </div>
    </div>

    <div class="footer">
        <img src="https://imgur.com/oGJF9X5.png" alt="Footer Logo">
    </div>

    <script>
        let allSuspensions = [];

        function parseDateForCalendar(dateStr) {
            if (!dateStr || typeof dateStr !== 'string' || dateStr === 'Data n√£o informada') {
                return null;
            }
            const parts = dateStr.split('/');
            if (parts.length !== 3) {
                return null;
            }
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1;
            const year = parseInt(parts[2], 10);
            return new Date(Date.UTC(year, month, day));
        }

        fetch('suspensions_2025_completo.json')
            .then(response => response.json())
            .then(data => {
                allSuspensions = data;
                generateCalendar();
            })
            .catch(error => {
                console.error('Erro ao carregar o JSON:', error);
                document.getElementById('suspensionsList').innerHTML = `<li>Erro ao carregar os dados: ${error.message}</li>`;
            });

        function generateCalendar() {
            let container = document.getElementById("calendarContainer");
            container.innerHTML = "";
            const months = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

            months.forEach((month, index) => {
                let firstDay = new Date(2025, index, 1).getDay();
                let daysInMonth = new Date(2025, index + 1, 0).getDate();
                let suspensionDays = {};

                const events = allSuspensions.filter(event => {
                    let inicioDate = parseDateForCalendar(event.inicio);
                    let fimDate = parseDateForCalendar(event.fim);

                    if (!inicioDate || !fimDate) return false;

                    const monthStart = new Date(Date.UTC(2025, index, 1));
                    const monthEnd = new Date(Date.UTC(2025, index + 1, 0));

                    return (inicioDate <= monthEnd && fimDate >= monthStart);
                });

                events.forEach(event => {
                    let inicioDate = parseDateForCalendar(event.inicio);
                    let fimDate = parseDateForCalendar(event.fim);
                    const monthStart = new Date(Date.UTC(2025, index, 1));
                    const monthEnd = new Date(Date.UTC(2025, index + 1, 0));
                    const start = inicioDate < monthStart ? monthStart : inicioDate;
                    const end = fimDate > monthEnd ? monthEnd : fimDate;

                    if (start.getUTCFullYear() === 2025 && end.getUTCFullYear() === 2025) {
                        for (let day = start.getUTCDate(); day <= end.getUTCDate(); day++) {
                            if (!suspensionDays[day]) suspensionDays[day] = [];
                            suspensionDays[day].push(event.unidade);
                        }
                    }
                });

                let calendar = `<div class='calendar' onclick="loadSuspensions(${index}, '${month}')"><h3>${month} 2025</h3><table>`;
                calendar += "<tr><th>D</th><th>S</th><th>T</th><th>Q</th><th>Q</th><th>S</th><th>S</th></tr><tr>";
                for (let i = 0; i < firstDay; i++) calendar += "<td></td>";

                for (let day = 1; day <= daysInMonth; day++) {
                    let highlightClass = '';
                    if (suspensionDays[day]?.includes("Poder Judici√°rio do Estado do Par√°")) {
                        highlightClass = 'highlight-judiciario';
                    }
                    calendar += `<td ${highlightClass ? `class='${highlightClass}'` : ''}>${day}</td>`;
                    if ((day + firstDay) % 7 === 0) calendar += "</tr><tr>";
                }
                calendar += "</tr></table></div>";
                container.innerHTML += calendar;
            });
        }

        function loadSuspensions(monthIndex, monthName) {
            const suspensionsList = document.getElementById('suspensionsList');
            const selectedMonthSpan = document.getElementById('selectedMonth');
            suspensionsList.innerHTML = '<li>Carregando...</li>';
            selectedMonthSpan.textContent = monthName;

            const events = allSuspensions.filter(event => {
                let inicioDate = parseDateForCalendar(event.inicio);
                let fimDate = parseDateForCalendar(event.fim);

                if (!inicioDate || !fimDate) return false;

                const monthStart = new Date(Date.UTC(2025, monthIndex, 1));
                const monthEnd = new Date(Date.UTC(2025, monthIndex + 1, 0));

                return (inicioDate <= monthEnd && fimDate >= monthStart);
            });

            populateSuspensions(events);
        }

        function formatDate(dateStr) {
            const date = parseDateForCalendar(dateStr);
            if (date && !isNaN(date.getTime())) {
                const day = String(date.getUTCDate()).padStart(2, '0');
                const month = String(date.getUTCMonth() + 1).padStart(2, '0');
                const year = date.getUTCFullYear();
                return `${day}/${month}/${year}`;
            }
            return dateStr;
        }

        function populateSuspensions(events) {
            const suspensionsList = document.getElementById('suspensionsList');
            suspensionsList.innerHTML = '';

            if (events.length === 0) {
                suspensionsList.innerHTML = '<li>Nenhuma suspens√£o encontrada</li>';
                return;
            }

            events.sort((a, b) => parseDateForCalendar(a.inicio) - parseDateForCalendar(b.inicio));

            events.forEach(event => {
                const li = document.createElement('li');
                li.className = 'suspension-item';

                const inicio = formatDate(event.inicio);
                const fim = formatDate(event.fim);
                const dateDisplay = inicio === fim ? inicio : `${inicio} a ${fim}`;
                const portariaClean = event.portaria.replace(/N¬∫\s*N¬∫/g, 'N¬∫');
                const edicaoClean = event.edicao.replace(/N¬∫\s*N¬∫/g, 'N¬∫');

                let situacao = event.motivo.toLowerCase().includes('remoto') ? 'Atendimento Remoto (Sem Suspens√£o de Prazo)' : 'Suspens√£o de Prazos';
                let corSituacao = event.motivo.toLowerCase().includes('remoto') ? 'üîµ' : 'üî¥';

                li.innerHTML = `
                    ‚öñÔ∏è <strong>Unidade:</strong> ${event.unidade}<br>
                    üìÜ <strong>Data:</strong> ${dateDisplay}<br>
                    ${corSituacao} <strong>Situa√ß√£o:</strong> ${situacao}<br>
                    üìå <strong>Motivo:</strong> ${event.motivo}<br>
                    üìÑ <strong>Portaria:</strong> ${portariaClean} - DJE ${edicaoClean}
                `;
                suspensionsList.appendChild(li);
            });

            document.getElementById('infoContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function normalizeText(text) {
            return text.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }

        function searchSuspensions() {
            const input = normalizeText(document.getElementById('searchInput').value.toLowerCase());
            const selectedMonthSpan = document.getElementById('selectedMonth');

            if (!input) {
                document.getElementById('suspensionsList').innerHTML = '';
                selectedMonthSpan.textContent = '';
                return;
            }

            const filteredEvents = allSuspensions.filter(event => {
                const inicioDate = parseDateForCalendar(event.inicio);
                const fimDate = parseDateForCalendar(event.fim);

                if (!inicioDate || !fimDate) return false;

                const matchesUnidade = normalizeText(event.unidade.toLowerCase()).includes(input);
                const matchesMotivo = normalizeText(event.motivo.toLowerCase()).includes(input);

                return matchesUnidade || matchesMotivo;
            });

            selectedMonthSpan.textContent = 'Resultados da Busca';
            populateSuspensions(filteredEvents);
        }

        function toggleContrast() {
            document.body.classList.toggle('high-contrast');
        }
    </script>
</body>
</html>
