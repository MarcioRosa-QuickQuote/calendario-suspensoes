<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário de Suspensões de Expedientes - 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            text-align: center;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
        }
        .header {
            background-color: #1E3A8A;
            color: white;
            padding: 20px;
            font-size: 26px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-image {
            height: 80px;
            margin-right: 20px;
        }
        .calendar-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            padding: 20px;
            max-width: 1200px;
            margin: auto;
        }
        .calendar {
            background: white;
            padding: 8px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.2s;
            cursor: pointer;
            position: relative;
        }
        .calendar:hover {
            transform: scale(1.05);
        }
        .calendar h3 {
            background-color: #1E3A8A;
            color: white;
            padding: 6px;
            border-radius: 5px;
            font-size: 14px;
            margin: 0;
        }
        .calendar table {
            width: 100%;
            margin-top: 5px;
            border-collapse: collapse;
            font-size: 10px;
        }
        .calendar th, .calendar td {
            padding: 4px;
            text-align: center;
            cursor: pointer;
            position: relative;
        }
        .calendar th {
            color: #1E3A8A;
            font-weight: bold;
        }
        .highlight {
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 4px;
            transition: 0.3s;
            display: inline-block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            line-height: 10px;
        }
        .highlight:hover {
            background-color: darkred;
        }
        .info-container {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }
        .info-container h2 {
            color: #1E3A8A;
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
        }
        .month-header {
            position: absolute;
            top: 10px;
            right: 50px;
            font-weight: bold;
            font-size: 16px;
            color: #000;
        }
        .search-container {
            margin-bottom: 10px;
            text-align: left;
            padding: 0 10px;
        }
        .search-container input {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .info-details {
            text-align: left;
            padding: 0 10px;
        }
        ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            text-align: left;
            width: 100%;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        li {
            margin: 0;
            padding: 0;
            text-align: left;
            line-height: 1.2;
            border-bottom: 1px solid #ccc;
        }
        li:last-child {
            border-bottom: none;
        }
        .suspension-item span {
            display: inline;
        }
        .suspension-item .unidade {
            font-weight: bold;
            display: block;
            margin: 0;
        }
        .suspension-item .motivo-line {
            display: block;
            margin: 0;
        }
        .suspension-item .portaria-line {
            display: block;
            margin: 0;
        }
        .motivo {
            font-weight: bold;
            margin-right: 5px;
            display: inline;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://i.imgur.com/bcjzam8.png" alt="Logo TJPA" class="header-image">
        Calendário de Suspensões de Expedientes - 2025
    </div>
    <div class="calendar-container" id="calendarContainer"></div>
    <div class="info-container" id="infoContainer">
        <h2>Informações da Suspensão de Expediente</h2>
        <div class="month-header" id="selectedMonth"></div>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Pesquisar por unidade..." onkeyup="searchSuspensions()">
        </div>
        <div class="info-details">
            <ul id="suspensionsList">
                <li>Clique em um mês no calendário para exibir as suspensões</li>
            </ul>
        </div>
    </div>

    <script>
        let allSuspensions = [];

        fetch('suspensions_2025_completo.json')
            .then(response => response.json())
            .then(data => {
                allSuspensions = data;
                generateCalendar();
            })
            .catch(error => {
                console.error('Erro ao carregar o JSON:', error);
                document.getElementById('suspensionsList').innerHTML = '<li>Erro ao carregar os dados</li>';
            });

        function generateCalendar() {
            let container = document.getElementById("calendarContainer");
            container.innerHTML = "";
            const months = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

            months.forEach((month, index) => {
                let firstDay = new Date(2025, index, 1).getDay();
                let daysInMonth = new Date(2025, index + 1, 0).getDate();
                let suspensionDays = {};

                // Filtra os eventos que têm interseção com o mês atual e com o ano de 2025
                const events = allSuspensions.filter(event => {
                    let inicioDate, fimDate;
                    try {
                        inicioDate = new Date(event.inicio.split('/').reverse().join('-'));
                        fimDate = new Date(event.fim.split('/').reverse().join('-'));
                    } catch (error) {
                        console.log(`Erro ao converter datas: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                        return false;
                    }

                    if (isNaN(inicioDate.getTime()) || isNaN(fimDate.getTime())) {
                        console.log(`Data inválida: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                        return false;
                    }

                    // Verifica se o evento tem interseção com 2025
                    const startYear = inicioDate.getFullYear();
                    const endYear = fimDate.getFullYear();
                    const intersects2025 = startYear <= 2025 && endYear >= 2025;

                    if (!intersects2025 && endYear < 2025) {
                        return false; // Exclui eventos que terminam antes de 2025
                    }

                    // Verifica se o evento tem interseção com o mês atual
                    const monthStart = new Date(2025, index, 1);
                    const monthEnd = new Date(2025, index + 1, 0);
                    return (inicioDate <= monthEnd && fimDate >= monthStart);
                });

                // Marca os dias com suspensões (apenas os dias de 2025)
                events.forEach(event => {
                    let inicioDate, fimDate;
                    try {
                        inicioDate = new Date(event.inicio.split('/').reverse().join('-'));
                        fimDate = new Date(event.fim.split('/').reverse().join('-'));
                    } catch (error) {
                        console.log(`Erro ao converter datas: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                        return;
                    }

                    // Ajusta o início e fim para o mês atual e o ano de 2025
                    const monthStart = new Date(2025, index, 1);
                    const monthEnd = new Date(2025, index + 1, 0);
                    const start = inicioDate < monthStart ? monthStart : inicioDate;
                    const end = fimDate > monthEnd ? monthEnd : fimDate;

                    if (start.getFullYear() === 2025 && end.getFullYear() === 2025) {
                        const startDay = start.getDate();
                        const endDay = end.getDate();
                        for (let day = startDay; day <= endDay; day++) {
                            suspensionDays[day] = true;
                        }
                    }
                });

                let calendar = `<div class='calendar' onclick="loadSuspensions(${index}, '${month}')"><h3>${month} 2025</h3><table>`;
                calendar += "<tr><th>D</th><th>S</th><th>T</th><th>Q</th><th>Q</th><th>S</th><th>S</th></tr><tr>";
                for (let i = 0; i < firstDay; i++) calendar += "<td></td>";
                for (let day = 1; day <= daysInMonth; day++) {
                    calendar += `<td ${suspensionDays[day] ? "class='highlight'" : ""}>${day}</td>`;
                    if ((day + firstDay) % 7 === 0) calendar += "</tr><tr>";
                }
                calendar += "</tr></table></div>";
                container.innerHTML += calendar;
            });
        }

        function loadSuspensions(monthIndex, monthName) {
            const suspensionsList = document.getElementById('suspensionsList');
            const selectedMonthSpan = document.getElementById('selectedMonth');
            suspensionsList.innerHTML = '<li>Carregando...</li>';
            selectedMonthSpan.textContent = monthName;

            // Filtra os eventos pelo mês selecionado e que têm interseção com 2025
            const events = allSuspensions.filter(event => {
                let inicioDate, fimDate;
                try {
                    inicioDate = new Date(event.inicio.split('/').reverse().join('-'));
                    fimDate = new Date(event.fim.split('/').reverse().join('-'));
                } catch (error) {
                    console.log(`Erro ao converter datas: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                    return false;
                }

                if (isNaN(inicioDate.getTime()) || isNaN(fimDate.getTime())) {
                    console.log(`Data inválida: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                    return false;
                }

                // Verifica se o evento tem interseção com 2025
                const startYear = inicioDate.getFullYear();
                const endYear = fimDate.getFullYear();
                const intersects2025 = startYear <= 2025 && endYear >= 2025;

                if (!intersects2025 && endYear < 2025) {
                    return false; // Exclui eventos que terminam antes de 2025
                }

                // Verifica se o evento tem interseção com o mês atual
                const monthStart = new Date(2025, monthIndex, 1);
                const monthEnd = new Date(2025, monthIndex + 1, 0);
                return (inicioDate <= monthEnd && fimDate >= monthStart);
            });

            populateSuspensions(events);
        }

        function formatDate(dateStr) {
            if (/^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) {
                return dateStr;
            }
            const date = new Date(dateStr);
            if (!isNaN(date.getTime())) {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
            return dateStr;
        }

        function populateSuspensions(events) {
            const suspensionsList = document.getElementById('suspensionsList');
            suspensionsList.innerHTML = '';
            if (events.length === 0) {
                suspensionsList.innerHTML = '<li>Nenhuma suspensão encontrada</li>';
                return;
            }
            events.forEach(event => {
                const li = document.createElement('li');
                li.className = 'suspension-item';
                let inicio = formatDate(event.inicio);
                let fim = formatDate(event.fim);
                const dateDisplay = inicio === fim ? inicio : `${inicio} a ${fim}`;
                const portariaClean = event.portaria.replace(/Nº\s*Nº/g, 'Nº');
                const edicaoClean = event.edicao.replace(/Nº\s*Nº/g, 'Nº');
                li.innerHTML = `
                    <span class="unidade">${event.unidade} - ${dateDisplay}</span>
                    <span class="motivo-line"><span class="motivo">Motivo:</span> ${event.motivo}</span>
                    <span class="portaria-line">Portaria ${portariaClean} - DJE ${edicaoClean}</span>
                `;
                suspensionsList.appendChild(li);
            });
        }

        function normalizeText(text) {
            return text.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }

        function searchSuspensions() {
            const input = normalizeText(document.getElementById('searchInput').value.toLowerCase());
            const suspensionsList = document.getElementById('suspensionsList');
            if (!input) {
                // Filtra apenas eventos que têm interseção com 2025 para a busca
                const events = allSuspensions.filter(event => {
                    let inicioDate, fimDate;
                    try {
                        inicioDate = new Date(event.inicio.split('/').reverse().join('-'));
                        fimDate = new Date(event.fim.split('/').reverse().join('-'));
                    } catch (error) {
                        console.log(`Erro ao converter datas: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                        return false;
                    }

                    const startYear = inicioDate.getFullYear();
                    const endYear = fimDate.getFullYear();
                    return startYear <= 2025 && endYear >= 2025 || endYear >= 2025;
                });
                populateSuspensions(events);
                return;
            }
            const filteredEvents = allSuspensions.filter(event => {
                let inicioDate, fimDate;
                try {
                    inicioDate = new Date(event.inicio.split('/').reverse().join('-'));
                    fimDate = new Date(event.fim.split('/').reverse().join('-'));
                } catch (error) {
                    console.log(`Erro ao converter datas: Início=${event.inicio}, Fim=${event.fim}, Unidade=${event.unidade}`);
                    return false;
                }

                const startYear = inicioDate.getFullYear();
                const endYear = fimDate.getFullYear();
                const intersects2025 = startYear <= 2025 && endYear >= 2025 || endYear >= 2025;
                return intersects2025 && normalizeText(event.unidade.toLowerCase()).includes(input);
            });
            if (filteredEvents.length === 0) {
                suspensionsList.innerHTML = '<li>Nenhuma suspensão encontrada</li>';
                return;
            }
            populateSuspensions(filteredEvents);
        }
    </script>
</body>
</html>
